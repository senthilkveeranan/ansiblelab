

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script type="text/javascript" src="https://www.redhat.com/dtm.js"></script>
  <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> 
  <meta class="swiftype" name="version" data-type="string" content="3.2.2">

  <!-- Google Tag Manager Data Layer -->
  <script>
   dataLayer = [];
  </script>
  <!-- End Google Tag Manager Data Layer -->

  
  <title>Using Ansible and Windows &mdash; Ansible Documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/user_guide/windows_usage.html"/>
  

  
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'2.8',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  false
      };
    </script>
      <script type="text/javascript" src="jquery.js"></script>
      <script type="text/javascript" src="underscore.js"></script>
      <script type="text/javascript" src="doctools.js"></script>

    
      <link rel="search" type="application/opensearchdescription+xml"
            title="Search within Ansible Documentation"
            href="https://docs.ansible.com/ansible/latest//_static/opensearch.xml"/>
    

  

  
    <link rel="stylesheet" href="theme.css" type="text/css" />
  <link rel="stylesheet" href="pygments.css" type="text/css" />
    <link rel="index" title="Index" href="https://docs.ansible.com/ansible/latest//genindex.html" />
    <link rel="search" title="Search" href="https://docs.ansible.com/ansible/latest//search.html" />
    <link rel="next" title="Desired State Configuration" href="windows_dsc.html" />
    <link rel="prev" title="Windows Remote Management" href="windows_winrm.html" /> 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>


  
  <script src="modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav"> 

  <!-- Google Tag Manager -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
  <!-- End Google Tag Manager -->

    <div class="DocSite-globalNav ansibleNav">
        <ul>
            <li><a href="https://www.ansible.com/ansiblefest" target="_blank">AnsibleFest</a></li>
            <li><a href="https://www.ansible.com/tower" target="_blank">Products</a></li>
            <li><a href="https://www.ansible.com/community" target="_blank">Community</a></li>
            <li><a href="https://www.ansible.com/webinars-training" target="_blank">Webinars & Training</a></li>
            <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
        </ul>
    </div>

  <a class="DocSite-nav" href="https://docs.ansible.com/" style="padding-bottom: 30px;">
      
    <img class="DocSiteNav-logo"
      src="logo_invert.png"
      alt="Ansible Logo">
    <div class="DocSiteNav-title">
      Documentation
    </div>
  </a>


  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

      <div style="background-color:#5bbdbf;height=80px;margin:'auto auto auto auto'">
        <a class="DocSiteProduct-header DocSiteProduct-header--core" href="https://docs.ansible.com/">
            <div class="DocSiteProduct-productName">
                <div class="DocSiteProduct-logoText">
                    Ansible  
                    <div class="DocSiteProduct-CurrentVersion" align="right">
                      2.8
                  </div>
                </div>
            </div>
        </a>

          <div class="DocSiteProduct-CheckVersionPara">For previous versions, see the  <a class="DocSiteProduct-versionheader" href="https://docs.ansible.com/#coreversionselect">documentation archive.</a></div>
      </div>

      <div class="wy-side-nav-search" style="background-color#5bbdbf;height=80px;margin:'auto auto auto auto'">
      <!-- <a href="../index.html" class="icon icon-home"> Ansible Documentation</a> -->
      
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://docs.ansible.com/ansible/latest//search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    </div>

    
          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Ansible</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Ansible Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_getting_started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line_tools.html">Working with Command Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_adhoc.html">Introduction To Ad-Hoc Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_inventory.html">Working with Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_dynamic_inventory.html">Working With Dynamic Inventory</a></li>
<li class="toctree-l2"><a class="reference internal" href="playbooks.html">Working With Playbooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="become.html">Understanding Privilege Escalation</a></li>
<li class="toctree-l2"><a class="reference internal" href="vault.html">Ansible Vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_patterns.html">Working with Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Working With Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//plugins/plugins.html">Working With Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro_bsd.html">BSD Support</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="windows.html">Windows Guides</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="windows_setup.html">Setting up a Windows Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="windows_winrm.html">Windows Remote Management</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="windows_usage.html#">Using Ansible and Windows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="windows_usage.html#use-cases">Use Cases</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_usage.html#path-formatting-for-windows">Path Formatting for Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_usage.html#limitations">Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="windows_usage.html#developing-windows-modules">Developing Windows Modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="windows_dsc.html">Desired State Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="windows_faq.html">Windows Frequently Asked Questions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//community/index.html">Ansible Community Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//scenario_guides/cloud_guides.html">Public Cloud Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//scenario_guides/network_guides.html">Network Technology Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//scenario_guides/virt_guides.html">Virtualization and Containerization Guides</a></li>
</ul>
<p class="caption"><span class="caption-text">Ansible for Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//network/index.html">Ansible for Network Automation</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//modules/modules_by_category.html">Module Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/galaxy.html">Ansible Galaxy</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/release_and_maintenance.html">Release and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//reference_appendices/tower.html">Ansible Tower</a></li>
</ul>
<p class="caption"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="https://docs.ansible.com/ansible/latest//roadmap/index.html">Ansible Roadmap</a></li>
</ul>

            
          
        </div>
            <!-- changeable widget -->
    <div id="sideBanner">
    <br/>
    <a href="https://www.ansible.com/docs-left?utm_source=docs">
      <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
    </a>
    </div>


      </div>
      &nbsp;
    </nav>
      </div>


    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="https://docs.ansible.com/ansible/latest//index.html">Ansible Documentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">

          <!-- Banner ads
          <div class="DocSiteBanner">
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-left.png">
            </a>
            <a class="DocSiteBanner-imgWrapper"
                href="https://www.ansible.com/docs-top?utm_source=docs">
                <img src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-top-right.png">
            </a>
        </div> -->

          <ul class="wy-breadcrumbs">
  <li><a href="https://docs.ansible.com/ansible/latest//index.html">Docs</a> &raquo;</li>
  <li><a href="windows_usage.html">Using Ansible and Windows</a></li>
  
    <li class="wy-breadcrumbs-aside">
      <a href="https://github.com/ansible/ansible/edit/devel/docs/docsite/rst/user_guide/windows_usage.rst?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr" class="icon icon-github"> Edit on GitHub</a>
    </li>
  
</ul>
<hr/>

          <div id="page-content">
          
  <div class="section" id="using-ansible-and-windows">
<h1>Using Ansible and Windows<a class="headerlink" href="windows_usage.html#using-ansible-and-windows" title="Permalink to this headline">¶</a></h1>
<p>When using Ansible to manage Windows, many of the syntax and rules that apply
for Unix/Linux hosts also apply to Windows, but there are still some differences
when it comes to components like path separators and OS-specific tasks.
This document covers details specific to using Ansible for Windows.</p>
<div class="contents local topic" id="topics">
<p class="topic-title first">Topics</p>
<ul class="simple">
<li><a class="reference internal" href="windows_usage.html#use-cases" id="id1">Use Cases</a><ul>
<li><a class="reference internal" href="windows_usage.html#installing-software" id="id2">Installing Software</a></li>
<li><a class="reference internal" href="windows_usage.html#installing-updates" id="id3">Installing Updates</a></li>
<li><a class="reference internal" href="windows_usage.html#set-up-users-and-groups" id="id4">Set Up Users and Groups</a><ul>
<li><a class="reference internal" href="windows_usage.html#local" id="id5">Local</a></li>
<li><a class="reference internal" href="windows_usage.html#domain" id="id6">Domain</a></li>
</ul>
</li>
<li><a class="reference internal" href="windows_usage.html#running-commands" id="id7">Running Commands</a><ul>
<li><a class="reference internal" href="windows_usage.html#choosing-command-or-shell" id="id8">Choosing Command or Shell</a></li>
<li><a class="reference internal" href="windows_usage.html#argument-rules" id="id9">Argument Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="windows_usage.html#creating-and-running-a-scheduled-task" id="id10">Creating and Running a Scheduled Task</a></li>
</ul>
</li>
<li><a class="reference internal" href="windows_usage.html#path-formatting-for-windows" id="id11">Path Formatting for Windows</a><ul>
<li><a class="reference internal" href="windows_usage.html#yaml-style" id="id12">YAML Style</a></li>
<li><a class="reference internal" href="windows_usage.html#legacy-key-value-style" id="id13">Legacy key=value Style</a></li>
</ul>
</li>
<li><a class="reference internal" href="windows_usage.html#limitations" id="id14">Limitations</a></li>
<li><a class="reference internal" href="windows_usage.html#developing-windows-modules" id="id15">Developing Windows Modules</a></li>
</ul>
</div>
<div class="section" id="use-cases">
<h2><a class="toc-backref" href="windows_usage.html#id1">Use Cases</a><a class="headerlink" href="windows_usage.html#use-cases" title="Permalink to this headline">¶</a></h2>
<p>Ansible can be used to orchestrate a multitude of tasks on Windows servers.
Below are some examples and info about common tasks.</p>
<div class="section" id="installing-software">
<h3><a class="toc-backref" href="windows_usage.html#id2">Installing Software</a><a class="headerlink" href="windows_usage.html#installing-software" title="Permalink to this headline">¶</a></h3>
<p>There are three main ways that Ansible can be used to install software:</p>
<ul class="simple">
<li>Using the <code class="docutils literal"><span class="pre">win_chocolatey</span></code> module. This sources the program data from the default
public <a class="reference external" href="https://chocolatey.org/">Chocolatey</a> repository. Internal repositories can
be used instead by setting the <code class="docutils literal"><span class="pre">source</span></code> option.</li>
<li>Using the <code class="docutils literal"><span class="pre">win_package</span></code> module. This installs software using an MSI or .exe installer
from a local/network path or URL.</li>
<li>Using the <code class="docutils literal"><span class="pre">win_command</span></code> or <code class="docutils literal"><span class="pre">win_shell</span></code> module to run an installer manually.</li>
</ul>
<p>The <code class="docutils literal"><span class="pre">win_chocolatey</span></code> module is recommended since it has the most complete logic for checking to see if a package has already been installed and is up-to-date.</p>
<p>Below are some examples of using all three options to install 7-Zip:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="c1"># Install/uninstall with chocolatey</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via Chocolatey</span>
  <span class="nt">win_chocolatey</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is not installed via Chocolatey</span>
  <span class="nt">win_chocolatey</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="c1"># Install/uninstall with win_package</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download the 7-Zip package</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.7-zip.org/a/7z1701-x64.msi</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via win_package</span>
  <span class="nt">win_package</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is not installed via win_package</span>
  <span class="nt">win_package</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>

<span class="c1"># Install/uninstall with win_command</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download the 7-Zip package</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://www.7-zip.org/a/7z1701-x64.msi</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\7z.msi</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Check if 7-Zip is already installed</span>
  <span class="nt">win_reg_stat</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{23170F69-40C1-2702-1701-000001000000}</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is installed via win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Windows\System32\msiexec.exe /i C:\temp\7z.msi /qn /norestart</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed.exists == false</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure 7-Zip is uninstalled via win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Windows\System32\msiexec.exe /x {23170F69-40C1-2702-1701-000001000000} /qn /norestart</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">7zip_installed.exists == true</span>
</pre></div>
</div>
<p>Some installers like Microsoft Office or SQL Server require credential delegation or
access to components restricted by WinRM. The best method to bypass these
issues is to use <code class="docutils literal"><span class="pre">become</span></code> with the task. With <code class="docutils literal"><span class="pre">become</span></code>, Ansible will run
the installer as if it were run interactively on the host.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Many installers do not properly pass back error information over WinRM. In these cases, if the install has been  verified to work locally the recommended method is to use become.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some installers restart the WinRM or HTTP services, or cause them to become temporarily unavailable, making Ansible assume the system is unreachable.</p>
</div>
</div>
<div class="section" id="installing-updates">
<h3><a class="toc-backref" href="windows_usage.html#id3">Installing Updates</a><a class="headerlink" href="windows_usage.html#installing-updates" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">win_updates</span></code> and <code class="docutils literal"><span class="pre">win_hotfix</span></code> modules can be used to install updates
or hotfixes on a host. The module <code class="docutils literal"><span class="pre">win_updates</span></code> is used to install multiple
updates by category, while <code class="docutils literal"><span class="pre">win_hotfix</span></code> can be used to install a single
update or hotfix file that has been downloaded locally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">win_hotfix</span></code> module has a requirement that the DISM PowerShell cmdlets are
present. These cmdlets were only added by default on Windows Server 2012
and newer and must be installed on older Windows hosts.</p>
</div>
<p>The following example shows how <code class="docutils literal"><span class="pre">win_updates</span></code> can be used:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install all critical and security updates</span>
  <span class="nt">win_updates</span><span class="p">:</span>
    <span class="nt">category_names</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">CriticalUpdates</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">SecurityUpdates</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">installed</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update_result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot host if required</span>
  <span class="nt">win_reboot</span><span class="p">:</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update_result.reboot_required</span>
</pre></div>
</div>
<p>The following example show how <code class="docutils literal"><span class="pre">win_hotfix</span></code> can be used to install a single
update or hotfix:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download KB3172729 for Server 2012 R2</span>
  <span class="nt">win_get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">http://download.windowsupdate.com/d/msdownload/update/software/secu/2016/07/windows8.1-kb3172729-x64_e8003822a7ef4705cbb65623b72fd3cec73fe222.msu</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\KB3172729.msu</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install hotfix</span>
  <span class="nt">win_hotfix</span><span class="p">:</span>
    <span class="nt">hotfix_kb</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KB3172729</span>
    <span class="nt">source</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\KB3172729.msu</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hotfix_result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot host if required</span>
  <span class="nt">win_reboot</span><span class="p">:</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hotfix_result.reboot_required</span>
</pre></div>
</div>
</div>
<div class="section" id="set-up-users-and-groups">
<h3><a class="toc-backref" href="windows_usage.html#id4">Set Up Users and Groups</a><a class="headerlink" href="windows_usage.html#set-up-users-and-groups" title="Permalink to this headline">¶</a></h3>
<p>Ansible can be used to create Windows users and groups both locally and on a domain.</p>
<div class="section" id="local">
<h4><a class="toc-backref" href="windows_usage.html#id5">Local</a><a class="headerlink" href="windows_usage.html#local" title="Permalink to this headline">¶</a></h4>
<p>The modules <code class="docutils literal"><span class="pre">win_user</span></code>, <code class="docutils literal"><span class="pre">win_group</span></code> and <code class="docutils literal"><span class="pre">win_group_membership</span></code> manage
Windows users, groups and group memberships locally.</p>
<p>The following is an example of creating local accounts and groups that can
access a folder on the same host:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create local group to contain new users</span>
  <span class="nt">win_group</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Allow access to C:\Development folder</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create local user</span>
  <span class="nt">win_user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.password</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>
    <span class="nt">update_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">password_never_expires</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
  <span class="nt">loop</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User1</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">User2</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password2</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create Development folder</span>
  <span class="nt">win_file</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set ACL of Development folder</span>
  <span class="nt">win_acl</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">rights</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FullControl</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">allow</span>
    <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LocalGroup</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove parent inheritance of Development folder</span>
  <span class="nt">win_acl_inheritance</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Development</span>
    <span class="nt">reorganize</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
</pre></div>
</div>
</div>
<div class="section" id="domain">
<h4><a class="toc-backref" href="windows_usage.html#id6">Domain</a><a class="headerlink" href="windows_usage.html#domain" title="Permalink to this headline">¶</a></h4>
<p>The modules <code class="docutils literal"><span class="pre">win_domain_user</span></code> and <code class="docutils literal"><span class="pre">win_domain_group</span></code> manages users and
groups in a domain. The below is an example of ensuring a batch of domain users
are created:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ensure each account is created</span>
  <span class="nt">win_domain_user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">upn</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.name</span> <span class="cp">}}</span><span class="s">@MY.DOMAIN.COM&#39;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span> <span class="nv">item.password</span> <span class="cp">}}</span><span class="s">&#39;</span>
    <span class="nt">password_never_expires</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
    <span class="nt">groups</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Test User</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">Application</span>
    <span class="nt">company</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible</span>
    <span class="nt">update_password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on_create</span>
  <span class="nt">loop</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Test User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Password</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Admin User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SuperSecretPass01</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Dev User</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&#39;@fvr3IbFBujSRh!3hBg%wgFucD8^x8W5&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-commands">
<h3><a class="toc-backref" href="windows_usage.html#id7">Running Commands</a><a class="headerlink" href="windows_usage.html#running-commands" title="Permalink to this headline">¶</a></h3>
<p>In cases where there is no appropriate module available for a task,
a command or script can be run using the <code class="docutils literal"><span class="pre">win_shell</span></code>, <code class="docutils literal"><span class="pre">win_command</span></code>, <code class="docutils literal"><span class="pre">raw</span></code>, and <code class="docutils literal"><span class="pre">script</span></code> modules.</p>
<p>The <code class="docutils literal"><span class="pre">raw</span></code> module simply executes a Powershell command remotely. Since <code class="docutils literal"><span class="pre">raw</span></code>
has none of the wrappers that Ansible typically uses, <code class="docutils literal"><span class="pre">become</span></code>, <code class="docutils literal"><span class="pre">async</span></code>
and environment variables do not work.</p>
<p>The <code class="docutils literal"><span class="pre">script</span></code> module executes a script from the Ansible controller on
one or more Windows hosts. Like <code class="docutils literal"><span class="pre">raw</span></code>, <code class="docutils literal"><span class="pre">script</span></code> currently does not support
<code class="docutils literal"><span class="pre">become</span></code>, <code class="docutils literal"><span class="pre">async</span></code>, or environment variables.</p>
<p>The <code class="docutils literal"><span class="pre">win_command</span></code> module is used to execute a command which is either an
executable or batch file, while the <code class="docutils literal"><span class="pre">win_shell</span></code> module is used to execute commands within a shell.</p>
<div class="section" id="choosing-command-or-shell">
<h4><a class="toc-backref" href="windows_usage.html#id8">Choosing Command or Shell</a><a class="headerlink" href="windows_usage.html#choosing-command-or-shell" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">win_shell</span></code> and <code class="docutils literal"><span class="pre">win_command</span></code> modules can both be used to execute a command or commands.
The <code class="docutils literal"><span class="pre">win_shell</span></code> module is run within a shell-like process like <code class="docutils literal"><span class="pre">PowerShell</span></code> or <code class="docutils literal"><span class="pre">cmd</span></code>, so it has access to shell
operators like <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">|</span></code>, <code class="docutils literal"><span class="pre">;</span></code>, <code class="docutils literal"><span class="pre">&amp;&amp;</span></code>, and <code class="docutils literal"><span class="pre">||</span></code>. Multi-lined commands can also be run in <code class="docutils literal"><span class="pre">win_shell</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">win_command</span></code> module simply runs a process outside of a shell. It can still
run a shell command like <code class="docutils literal"><span class="pre">mkdir</span></code> or <code class="docutils literal"><span class="pre">New-Item</span></code> by passing the shell commands
to a shell executable like <code class="docutils literal"><span class="pre">cmd.exe</span></code> or <code class="docutils literal"><span class="pre">PowerShell.exe</span></code>.</p>
<p>Here are some examples of using <code class="docutils literal"><span class="pre">win_command</span></code> and <code class="docutils literal"><span class="pre">win_shell</span></code>:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a command under PowerShell</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Get-Service -Name service | Stop-Service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a command under cmd</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mkdir C:\temp</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="nt">executable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a multiple shell commands</span>
  <span class="nt">win_shell</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">New-Item -Path C:\temp -ItemType Directory</span>
    <span class="no">Remove-Item -Path C:\temp -Force -Recurse</span>
    <span class="no">$path_info = Get-Item -Path C:\temp</span>
    <span class="no">$path_info.FullName</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run an executable using win_command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">whoami.exe</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a cmd command</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe /c mkdir C:\temp</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run a vbs script</span>
  <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cscript.exe script.vbs</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some commands like <code class="docutils literal"><span class="pre">mkdir</span></code>, <code class="docutils literal"><span class="pre">del</span></code>, and <code class="docutils literal"><span class="pre">copy</span></code> only exist in
the CMD shell. To run them with <code class="docutils literal"><span class="pre">win_command</span></code> they must be
prefixed with <code class="docutils literal"><span class="pre">cmd.exe</span> <span class="pre">/c</span></code>.</p>
</div>
</div>
<div class="section" id="argument-rules">
<h4><a class="toc-backref" href="windows_usage.html#id9">Argument Rules</a><a class="headerlink" href="windows_usage.html#argument-rules" title="Permalink to this headline">¶</a></h4>
<p>When running a command through <code class="docutils literal"><span class="pre">win_command</span></code>, the standard Windows argument
rules apply:</p>
<ul class="simple">
<li>Each argument is delimited by a white space, which can either be a space or a
tab.</li>
<li>An argument can be surrounded by double quotes <code class="docutils literal"><span class="pre">&quot;</span></code>. Anything inside these
quotes is interpreted as a single argument even if it contains whitespace.</li>
<li>A double quote preceded by a backslash <code class="docutils literal"><span class="pre">\</span></code> is interpreted as just a double
quote <code class="docutils literal"><span class="pre">&quot;</span></code> and not as an argument delimiter.</li>
<li>Backslashes are interpreted literally unless it immediately precedes double
quotes; for example <code class="docutils literal"><span class="pre">\</span></code> == <code class="docutils literal"><span class="pre">\</span></code> and <code class="docutils literal"><span class="pre">\&quot;</span></code> == <code class="docutils literal"><span class="pre">&quot;</span></code></li>
<li>If an even number of backslashes is followed by a double quote, one
backslash is used in the argument for every pair, and the double quote is
used as a string delimiter for the argument.</li>
<li>If an odd number of backslashes is followed by a double quote, one backslash
is used in the argument for every pair, and the double quote is escaped and
made a literal double quote in the argument.</li>
</ul>
<p>With those rules in mind, here are some examples of quoting:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\executable.exe argument1 &quot;argument 2&quot; &quot;C:\path\with space&quot; &quot;double \&quot;quoted\&quot;&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\temp\executable.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = argument1</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = argument 2</span>
<span class="l l-Scalar l-Scalar-Plain">argv[3] = C:\path\with space</span>
<span class="l l-Scalar l-Scalar-Plain">argv[4] = double &quot;quoted&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="s">&#39;&quot;C:\Program</span><span class="nv"> </span><span class="s">Files\Program\program.exe&quot;</span><span class="nv"> </span><span class="s">&quot;escaped</span><span class="nv"> </span><span class="s">\\\&quot;</span><span class="nv"> </span><span class="s">backslash&quot;</span><span class="nv"> </span><span class="s">unquoted-end-backslash\&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\Program Files\Program\program.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = escaped \&quot; backslash</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = unquoted-end-backslash\</span>

<span class="c1"># Due to YAML and Ansible parsing &#39;\&quot;&#39; must be written as &#39;</span><span class="cp">{%</span> <span class="k">raw</span> <span class="cp">%}</span>\\<span class="cp">{%</span> <span class="k">endraw</span> <span class="cp">%}</span><span class="c1">&quot;&#39;</span>
<span class="p p-Indicator">-</span> <span class="nt">win_command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\temp\executable.exe C:\no\space\path &quot;arg with end \ before end quote</span><span class="cp">{%</span> <span class="k">raw</span> <span class="cp">%}</span>\\<span class="cp">{%</span> <span class="k">endraw</span> <span class="cp">%}</span><span class="l l-Scalar l-Scalar-Plain">&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">argv[0] = C:\temp\executable.exe</span>
<span class="l l-Scalar l-Scalar-Plain">argv[1] = C:\no\space\path</span>
<span class="l l-Scalar l-Scalar-Plain">argv[2] = arg with end \ before end quote\&quot;</span>
</pre></div>
</div>
<p>For more information, see <a class="reference external" href="https://msdn.microsoft.com/en-us/library/17w5ykft(v=vs.85).aspx">escaping arguments</a>.</p>
</div>
</div>
<div class="section" id="creating-and-running-a-scheduled-task">
<h3><a class="toc-backref" href="windows_usage.html#id10">Creating and Running a Scheduled Task</a><a class="headerlink" href="windows_usage.html#creating-and-running-a-scheduled-task" title="Permalink to this headline">¶</a></h3>
<p>WinRM has some restrictions in place that cause errors when running certain
commands. One way to bypass these restrictions is to run a command through a
scheduled task. A scheduled task is a Windows component that provides the
ability to run an executable on a schedule and under a different account.</p>
<p>Ansible version 2.5 added modules that make it easier to work with scheduled tasks in Windows.
The following is an example of running a script as a scheduled task that deletes itself after
running:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create scheduled task to run a process</span>
  <span class="nt">win_scheduled_task</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">adhoc-task</span>
    <span class="nt">username</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SYSTEM</span>
    <span class="nt">actions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PowerShell.exe</span>
      <span class="nt">arguments</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">Start-Sleep -Seconds 30  # This isn&#39;t required, just here as a demonstration</span>
        <span class="no">New-Item -Path C:\temp\test -ItemType Directory</span>
    <span class="c1"># Remove this action if the task shouldn&#39;t be deleted on completion</span>
    <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cmd.exe</span>
      <span class="nt">arguments</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/c schtasks.exe /Delete /TN &quot;adhoc-task&quot; /F</span>
    <span class="nt">triggers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">registration</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Wait for the scheduled task to complete</span>
  <span class="nt">win_scheduled_task_stat</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">adhoc-task</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">task_stat</span>
  <span class="nt">until</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(task_stat.state is defined and task_stat.state.status != &quot;TASK_STATE_RUNNING&quot;) or (task_stat.task_exists == False)</span>
  <span class="nt">retries</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12</span>
  <span class="nt">delay</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The modules used in the above example were updated/added in Ansible
version 2.5.</p>
</div>
</div>
</div>
<div class="section" id="path-formatting-for-windows">
<h2><a class="toc-backref" href="windows_usage.html#id11">Path Formatting for Windows</a><a class="headerlink" href="windows_usage.html#path-formatting-for-windows" title="Permalink to this headline">¶</a></h2>
<p>Windows differs from a traditional POSIX operating system in many ways. One of
the major changes is the shift from <code class="docutils literal"><span class="pre">/</span></code> as the path separator to <code class="docutils literal"><span class="pre">\</span></code>. This
can cause major issues with how playbooks are written, since <code class="docutils literal"><span class="pre">\</span></code> is often used
as an escape character on POSIX systems.</p>
<p>Ansible allows two different styles of syntax; each deals with path separators for Windows differently:</p>
<div class="section" id="yaml-style">
<h3><a class="toc-backref" href="windows_usage.html#id12">YAML Style</a><a class="headerlink" href="windows_usage.html#yaml-style" title="Permalink to this headline">¶</a></h3>
<p>When using the YAML syntax for tasks, the rules are well-defined by the YAML
standard:</p>
<ul class="simple">
<li>When using a normal string (without quotes), YAML will not consider the
backslash an escape character.</li>
<li>When using single quotes <code class="docutils literal"><span class="pre">'</span></code>, YAML will not consider the backslash an
escape character.</li>
<li>When using double quotes <code class="docutils literal"><span class="pre">&quot;</span></code>, the backslash is considered an escape
character and needs to escaped with another backslash.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should only quote strings when it is absolutely
necessary or required by YAML, and then use single quotes.</p>
</div>
<p>The YAML specification considers the following <a class="reference external" href="http://yaml.org/spec/current.html#id2517668">escape sequences</a>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">\0</span></code>, <code class="docutils literal"><span class="pre">\\</span></code>, <code class="docutils literal"><span class="pre">\&quot;</span></code>, <code class="docutils literal"><span class="pre">\_</span></code>, <code class="docutils literal"><span class="pre">\a</span></code>, <code class="docutils literal"><span class="pre">\b</span></code>, <code class="docutils literal"><span class="pre">\e</span></code>, <code class="docutils literal"><span class="pre">\f</span></code>, <code class="docutils literal"><span class="pre">\n</span></code>, <code class="docutils literal"><span class="pre">\r</span></code>, <code class="docutils literal"><span class="pre">\t</span></code>,
<code class="docutils literal"><span class="pre">\v</span></code>, <code class="docutils literal"><span class="pre">\L</span></code>, <code class="docutils literal"><span class="pre">\N</span></code> and <code class="docutils literal"><span class="pre">\P</span></code> &#8211; Single character escape</li>
<li><code class="docutils literal"><span class="pre">&lt;TAB&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;SPACE&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;NBSP&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;LNSP&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;PSP&gt;</span></code> &#8211; Special
characters</li>
<li><code class="docutils literal"><span class="pre">\x..</span></code> &#8211; 2-digit hex escape</li>
<li><code class="docutils literal"><span class="pre">\u....</span></code> &#8211; 4-digit hex escape</li>
<li><code class="docutils literal"><span class="pre">\U........</span></code> &#8211; 8-digit hex escape</li>
</ul>
<p>Here are some examples on how to write Windows paths:</p>
<div class="highlight-yaml+jinja"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\Windows\Temp</span>

<span class="c1"># WORKS</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="s">&#39;C:\Windows\Temp&#39;</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="s">&quot;C:\\Windows\\Temp&quot;</span>

<span class="c1"># BAD, BUT SOMETIMES WORKS</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:\\Windows\\Temp</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="s">&#39;C:\\Windows\\Temp&#39;</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C:/Windows/Temp</span>

<span class="c1"># FAILS</span>
<span class="nt">tempdir</span><span class="p">:</span> <span class="s">&quot;C:</span><span class="err">\</span><span class="s">Windows</span><span class="err">\</span><span class="s">Temp&quot;</span>

<span class="nn">---</span>
<span class="c1"># Example of single quotes when they are required</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy tomcat config</span>
  <span class="nt">win_copy</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">log4j.xml</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&#39;</span><span class="cp">{{</span><span class="nv">tc_home</span><span class="cp">}}</span><span class="s">\lib\log4j.xml&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="legacy-key-value-style">
<h3><a class="toc-backref" href="windows_usage.html#id13">Legacy key=value Style</a><a class="headerlink" href="windows_usage.html#legacy-key-value-style" title="Permalink to this headline">¶</a></h3>
<p>The legacy <code class="docutils literal"><span class="pre">key=value</span></code> syntax is used on the command line for ad-hoc commands,
or inside playbooks. The use of this style is discouraged within playbooks
because backslash characters need to be escaped, making playbooks harder to read.
The legacy syntax depends on the specific implementation in Ansible, and quoting
(both single and double) does not have any effect on how it is parsed by
Ansible.</p>
<p>The Ansible key=value parser parse_kv() considers the following escape
sequences:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">\</span></code>, <code class="docutils literal"><span class="pre">'</span></code>, <code class="docutils literal"><span class="pre">&quot;</span></code>, <code class="docutils literal"><span class="pre">\a</span></code>, <code class="docutils literal"><span class="pre">\b</span></code>, <code class="docutils literal"><span class="pre">\f</span></code>, <code class="docutils literal"><span class="pre">\n</span></code>, <code class="docutils literal"><span class="pre">\r</span></code>, <code class="docutils literal"><span class="pre">\t</span></code> and
<code class="docutils literal"><span class="pre">\v</span></code> &#8211; Single character escape</li>
<li><code class="docutils literal"><span class="pre">\x..</span></code> &#8211; 2-digit hex escape</li>
<li><code class="docutils literal"><span class="pre">\u....</span></code> &#8211; 4-digit hex escape</li>
<li><code class="docutils literal"><span class="pre">\U........</span></code> &#8211; 8-digit hex escape</li>
<li><code class="docutils literal"><span class="pre">\N{...}</span></code> &#8211; Unicode character by name</li>
</ul>
<p>This means that the backslash is an escape character for some sequences, and it
is usually safer to escape a backslash when in this form.</p>
<p>Here are some examples of using Windows paths with the key=value style:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\\Windows\\Temp</span>

<span class="c1"># WORKS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\\Windows\\Temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\\Windows\\Temp&quot;</span>

<span class="c1"># BAD, BUT SOMETIMES WORKS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\Windows\Temp</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\Windows\Temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\Windows\Temp&quot;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:/Windows/Temp</span>

<span class="c1"># FAILS</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">C:\Windows\temp</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&#39;C:\Windows\temp&#39;</span>
<span class="na">tempdir</span><span class="o">=</span><span class="s">&quot;C:\Windows\temp&quot;</span>
</pre></div>
</div>
<p>The failing examples don&#8217;t fail outright but will substitute <code class="docutils literal"><span class="pre">\t</span></code> with the
<code class="docutils literal"><span class="pre">&lt;TAB&gt;</span></code> character resulting in <code class="docutils literal"><span class="pre">tempdir</span></code> being <code class="docutils literal"><span class="pre">C:\Windows&lt;TAB&gt;emp</span></code>.</p>
</div>
</div>
<div class="section" id="limitations">
<h2><a class="toc-backref" href="windows_usage.html#id14">Limitations</a><a class="headerlink" href="windows_usage.html#limitations" title="Permalink to this headline">¶</a></h2>
<p>Some things you cannot do with Ansible and Windows are:</p>
<ul class="simple">
<li>Upgrade PowerShell</li>
<li>Interact with the WinRM listeners</li>
</ul>
<p>Because WinRM is reliant on the services being online and running during normal operations, you cannot upgrade PowerShell or interact with WinRM listeners with Ansible. Both of these actions will cause the connection to fail. This can technically be avoided by using <code class="docutils literal"><span class="pre">async</span></code> or a scheduled task, but those methods are fragile if the process it runs breaks the underlying connection Ansible uses, and are best left to the bootstrapping process or before an image is
created.</p>
</div>
<div class="section" id="developing-windows-modules">
<h2><a class="toc-backref" href="windows_usage.html#id15">Developing Windows Modules</a><a class="headerlink" href="windows_usage.html#developing-windows-modules" title="Permalink to this headline">¶</a></h2>
<p>Because Ansible modules for Windows are written in PowerShell, the development
guides for Windows modules differ substantially from those for standard standard modules. Please see
<a class="reference internal" href="https://docs.ansible.com/ansible/latest//dev_guide/developing_modules_general_windows.html#developing-modules-general-windows"><span class="std std-ref">Windows module development walkthrough</span></a> for more information.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<dl class="last docutils">
<dt><a class="reference internal" href="index.html"><span class="doc">User Guide</span></a></dt>
<dd>The documentation index</dd>
<dt><a class="reference internal" href="playbooks.html"><span class="doc">Working With Playbooks</span></a></dt>
<dd>An introduction to playbooks</dd>
<dt><a class="reference internal" href="playbooks_best_practices.html"><span class="doc">Best Practices</span></a></dt>
<dd>Best practices advice</dd>
<dt><a class="reference internal" href="https://docs.ansible.com/ansible/latest//modules/list_of_windows_modules.html#windows-modules"><span class="std std-ref">List of Windows Modules</span></a></dt>
<dd>Windows specific module list, all implemented in PowerShell</dd>
<dt><a class="reference external" href="https://groups.google.com/group/ansible-project">User Mailing List</a></dt>
<dd>Have a question?  Stop by the google group!</dd>
<dt><a class="reference external" href="http://irc.freenode.net">irc.freenode.net</a></dt>
<dd>#ansible IRC chat channel</dd>
</dl>
</div>
</div>
</div>


          </div>
          <div id="search-results"><gcse:searchresults-only></div>
          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="windows_dsc.html" class="btn btn-neutral float-right" title="Desired State Configuration"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="windows_winrm.html" class="btn btn-neutral" title="Windows Remote Management"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

  <p>Last updated on May 17, 2019.<br/>
  Copyright © 2018 Red Hat, Inc. <br/>
  </p>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.8',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="jquery.js"></script>
      <script type="text/javascript" src="underscore.js"></script>
      <script type="text/javascript" src="doctools.js"></script>

  

  
  
    <script type="text/javascript" src="theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 
<!-- begin analytics -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
        (function(d,s,i,r) {
        if (d.getElementById(i)){return;}
        var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
        n.id=i;n.src = '//js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
        e.parentNode.insertBefore(n, e);
        })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script type="text/javascript">
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
_satellite.pageBottom();
}
</script>
</body>
</html>